<!DOCTYPE html>
<html>
<head>
    <title>Housing Policies Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <style>
        #map { height: 100vh; }
    </style>
</head>
<body>
    <div id="map"></div>
    <select id="policySelect">
        <option value="ADU">ADU</option>
        <option value="ARPA">ARPA</option>
        <option value="Bond Caps">Bond Caps</option>
        <option value="CCD">CCD</option>
        <!-- Add other policies here -->
    </select>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([37.8, -96], 4); // center map on the US

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Initialize geojson layer for the map
        var geojsonLayer = L.geoJSON(null, {
            onEachFeature: function (feature, layer) {
                layer.bindPopup("<strong>State:</strong> " + feature.properties.NAME + "<br>" +
                                "<strong>ADU:</strong> " + feature.properties.ADU + "<br>" +
                                "<strong>ARPA:</strong> " + feature.properties.ARPA + "<br>" +
                                "<strong>Bond Caps:</strong> " + feature.properties['Bond Caps']);
            }
        }).addTo(map);

        // Function to style GeoJSON based on selected policy
        function getStyle(feature, selectedPolicy) {
            var policyValue = feature.properties[selectedPolicy];
            return {
                fillColor: policyValue === 1 ? 'green' : 'red', // green for 1, red for 0
                weight: 1,
                opacity: 1,
                color: 'black',
                dashArray: '3',
                fillOpacity: 0.7
            };
        }

        // Function to load GeoJSON data and apply styles
        function loadGeoJSONData(selectedPolicy) {
            fetch('https://raw.githubusercontent.com/username/repository/branch/housing_policies.json')
                .then(response => response.json())
                .then(data => {
                    geojsonLayer.clearLayers(); // Clear any existing data
                    L.geoJSON(data, {
                        style: function(feature) {
                            return getStyle(feature, selectedPolicy);
                        },
                        onEachFeature: function (feature, layer) {
                            layer.bindPopup("<strong>State:</strong> " + feature.properties.NAME + "<br>" +
                                            "<strong>ADU:</strong> " + feature.properties.ADU + "<br>" +
                                            "<strong>ARPA:</strong> " + feature.properties.ARPA + "<br>" +
                                            "<strong>Bond Caps:</strong> " + feature.properties['Bond Caps']);
                        }
                    }).addTo(map);
                })
                .catch(error => console.error('Error loading GeoJSON:', error));
        }

        // Initial load with default policy (e.g., "ADU")
        loadGeoJSONData('ADU');

        // Change policy on selection change
        document.getElementById('policySelect').addEventListener('change', function() {
            var selectedPolicy = this.value;
            loadGeoJSONData(selectedPolicy); // Reload GeoJSON with selected policy
        });
    </script>
</body>
</html>
